"0","# only including if each 5-day period involves more than N cases; otherwise have things like increases of 1700%"
"0","t5_thresh <- 10"
"0","elapsed <- county %>%"
"0","  mutate(days_ago = (date_range[2] - date) %>%"
"0","           str_pad(width = 2, side = ""left"", pad = ""0"") %>%"
"0","           paste0(""t"", .))"
"0",""
"0","dates_elapsed <- elapsed %>%"
"0","  distinct(days_ago, date) %>%"
"0","  mutate(date = format(date, ""%m/%d"")) %>%"
"0","  tibble::deframe()"
"0",""
"0","case_change <- elapsed %>%"
"0","  filter(level != ""noid"", days_ago %in% c(""t00"", ""t05"", ""t10"")) %>%"
"0","  select(days_ago, level, name, cases) %>%"
"0","  pivot_wider(names_from = days_ago, values_from = cases) %>%"
"0","  mutate(new_cases_t05_t10 = t05 - t10,"
"0","         new_cases_t00_t05 = t00 - t05,"
"0","         pct_change = (new_cases_t00_t05 - new_cases_t05_t10) / new_cases_t05_t10) %>%"
"0","  filter_at(vars(starts_with(""new_cases"")), ~ . >= t5_thresh)"
"0",""
"0","change_table <- case_change %>%"
"0","  arrange(level, name) %>%"
"0","  select(-matches(""^t\\d"")) %>%"
"0","  pivot_longer(-c(level, name), names_to = ""variable"") %>%"
"0","  extract(variable, into = c(""type"", ""end"", ""start""), ""(^\\w+)_(t\\d{2})_(t\\d{2}$)"", remove = FALSE) %>%"
"0","  mutate_at(vars(end, start), recode, !!!dates_elapsed) %>%"
"0","  mutate(type = coalesce(type, variable),"
"0","         lbl = ifelse(is.na(end), type, str_glue(""{type}, {start} to {end}"")) %>%"
"0","           clean_titles(),"
"0","         name = ifelse(level == ""county"", paste(name, ""County""), as.character(name))) %>%"
"0","  select(Name = name, lbl, value) %>%"
"0","  pivot_wider(names_from = lbl)"
"0",""
"0","# datatable(change_table,"
"0","#           options = list(searching = FALSE, order = list(list(4, ""desc""))),"
"0","#           rownames = FALSE) %>%"
"0","#   formatRound(2:3, digits = 0) %>%"
"0","#   formatPercentage(4)"
"0",""
"0","datatable(change_table,"
"0","          options = list(searching = FALSE, paging = FALSE, info = FALSE),"
"0","          rownames = FALSE) %>%"
"0","  formatRound(2:3, digits = 0) %>%"
"0","  formatPercentage(4)"
